import{T as m,L as v,i as w}from"../_astro/scripts.psFpu7fM.js";import{u as k,l as x,h as S,a as $}from"../_astro/Loading.GowfwsGL.js";import{l as E}from"../_astro/localforage.WJDvAe_L.js";import{e as A}from"../_astro/epubjs.DksIVjnn.js";import"../_astro/vendor.t3tUpFQ-.js";import{S as L}from"../_astro/sortablejs.DJo-CWZx.js";import"../_astro/dayjs.DlUGhJdR.js";import"../_astro/aplayer.Be6-aBBk.js";import"../_astro/vanilla-lazyload.CwDt0XVP.js";import"../_astro/echarts.DcxwqiII.js";import"../_astro/leancloud-storage.CjrZWAQ1.js";import"../_astro/jszip.C3unUf8N.js";import"../_astro/lodash.CgCKa2MW.js";let f=document.querySelector(".add-btn"),d=document.querySelector(".add-btn input"),o=document.querySelector("#books");o&&L.create(o,{animation:150,draggable:".book-item",onEnd:async()=>{const t=Array.from(o.children).map((t=>t.getAttribute("data-id"))).filter((t=>!!t));try{await Promise.all(t.map(((t,e)=>k(t,{order:e+1})))),m("排序已保存！")}catch{m("保存排序失败，请重试！")}}}),f&&(f.onclick=()=>{d.click()});let a=x(o);o&&o.addEventListener("click",(t=>{if("BUTTON"===t.target.tagName){let e=t.target,o=e.getAttribute("data-id"),r=e.getAttribute("data-object-id");a.show({}),r&&S(r).then((()=>{a.hide(),m("删除成功！"),document.querySelector(`#${o}`)?.remove()}))}})),d&&(d.onchange=t=>{[...t.target.files].map((async t=>{let e=A(t);e.ready.then((async()=>{a.show({});let r=await e.coverUrl(),s=await fetch(r).then((t=>t.blob())),i=new FileReader;i.readAsDataURL(s),i.onload=()=>{a.show({precent:0}),$(t.name,t,{cover:{base64:i.result},onprogress:t=>{a.show({precent:t.percent.toFixed(2)})}}).then((e=>{const{attributes:r,id:s}=e;let i=document.createElement("div"),n=o.querySelectorAll(".remove-btn");i.id=`book${n.length+1}`,i.setAttribute("class","book-item bg-[var(--byt-white-color)] w-full overflow-hidden rounded shadow-[var(--byt-box-shadow)]"),i.innerHTML=`<a href='/eBook/${t.name.split("_")[0]}'><div class='w-full  overflow-hidden'  title='${r.title}'>\n                        <img data-byt-lz-src='${r.img.replace("dailynote","blog-cloud")}' class="h-[230px] sm:h-[260px] w-full" alt={item.title} />\n                        <h3 class="text-center !text-sm !line-clamp-1 mt-2">${t.name.split("_")[0]}-${t.name.split("_")[1]}</h3></div></a><div class="flex justify-center my-1"><button class="remove-btn border px-1 rounded-md text-[var(--byt-main-color)] border-[var(--byt-main-color)] cursor-pointer" data-object-id=${s} data-id="book${n.length+1}">删除</button></div>`,o.prepend(i),E.setItem("book_"+t.name,t.arrayBuffer()),m("上传成功！"),d.value="",a.hide(),v()}))}}))}))});const s=document.querySelector(".main-inner-content>.byt-tools-main>main.ebook-main");s&&(s.innerHTML=""),w((()=>{s&&(s.innerHTML="")}));