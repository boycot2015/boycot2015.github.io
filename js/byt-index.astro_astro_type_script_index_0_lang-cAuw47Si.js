import{T as h,L as y,i as w}from"../_astro/scripts.ipVVKLBg.js";import{l as k,h as x,u as $}from"../_astro/Loading.C2lVnrDn.js";import{l as E}from"../_astro/localforage.WJDvAe_L.js";import{e as L}from"../_astro/epubjs.CeVdWXvm.js";import"../_astro/vendor.BCD9q0To.js";import"../_astro/sortablejs.f5V9loet.js";import"../_astro/dayjs.DlUGhJdR.js";import"../_astro/aplayer.Be6-aBBk.js";import"../_astro/vanilla-lazyload.CwDt0XVP.js";import"../_astro/echarts.VfcM2RMM.js";import"../_astro/leancloud-storage.CjrZWAQ1.js";import"../_astro/jszip.C3unUf8N.js";import"../_astro/lodash.CgCKa2MW.js";let p=document.querySelector(".add-btn"),l=document.querySelector(".add-btn input"),r=document.querySelector("#books");p&&(p.onclick=()=>{l.click()});let t=k(r);r&&r.addEventListener("click",(e=>{if("BUTTON"===e.target.tagName){let o=e.target,r=o.getAttribute("data-id"),a=o.getAttribute("data-object-id");t.show({}),a&&x(a).then((()=>{t.hide(),h("删除成功！"),document.querySelector(`#${r}`)?.remove()}))}})),l&&(l.onchange=e=>{[...e.target.files].map((async e=>{let o=L(e);o.ready.then((async()=>{t.show({});let a=await o.coverUrl(),s=await fetch(a).then((t=>t.blob())),n=new FileReader;n.readAsDataURL(s),n.onload=()=>{t.show({precent:0}),$(e.name,e,{cover:{base64:n.result},onprogress:e=>{t.show({precent:e.percent.toFixed(2)})}}).then((o=>{const{attributes:a,id:s}=o;let n=document.createElement("div"),i=r.querySelectorAll(".remove-btn");n.id=`book${i.length+1}`,n.setAttribute("class","book-item bg-[var(--byt-white-color)] w-full overflow-hidden rounded shadow-[var(--byt-box-shadow)]"),n.innerHTML=`<a href='/eBook/${e.name.split("_")[0]}'><div class='w-full  overflow-hidden'  title='${a.title}'>\n                        <img data-byt-lz-src='${a.img.replace("dailynote","blog-cloud")}' class="h-[230px] sm:h-[260px] w-full" alt={item.title} />\n                        <h3 class="text-center !text-sm !line-clamp-1 mt-2">${e.name.split("_")[0]}-${e.name.split("_")[1]}</h3></div></a><div class="flex justify-center my-1"><button class="remove-btn border px-1 rounded-md text-[var(--byt-main-color)] border-[var(--byt-main-color)] cursor-pointer" data-object-id=${s} data-id="book${i.length+1}">删除</button></div>`,r.prepend(n),E.setItem("book_"+e.name,e.arrayBuffer()),h("上传成功！"),l.value="",t.hide(),y()}))}}))}))});const n=document.querySelector(".main-inner-content>.byt-tools-main>main.ebook-main");n&&(n.innerHTML=""),w((()=>{n&&(n.innerHTML="")}));