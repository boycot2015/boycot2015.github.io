import{A as s}from"./leancloud-storage.CjrZWAQ1.js";s.init({appId:"UFDAemKla2uvRCDNCBEGsVnA-gzGzoHsz",appKey:"mbNoKxkqSI3raGFUKAR1acV6",serverURL:"https://cloud.boycot.top"});const{Query:u,File:d}=s,b=s.Object.extend("Book"),m=()=>{const e=new u("Book");return e.select(["title","author","order","marks","url","fileId","img","imgId","createdAt"]),e.descending("createdAt"),e.find().then((function(e){return e.sort(((e,t)=>e.attributes.order-t.attributes.order))}),(function(e){console.error("操作失败",e)}))},h=(e,t)=>{const o=s.Object.createWithoutData("Book",e);for(const e in t)t[e]&&o.set(e,t[e]);return o.save().then((function(e){return e}),(function(e){console.error("保存失败",e)}))},f=async(e,t,o)=>{const r=new d(e,t),n=new b,{cover:s,onprogress:a}=o;if(n.set("title",e.split("_")[0]),n.set("author",e.split("_")[1]||""),n.set("order",0),n.set("marks",[]),s){let t=await new d(e.split(".")[0]+"_cover.png",s).save({keepFileName:!0}).then((e=>e));t&&n.set("img",t.url()),console.log(t.id,"coverUrl"),t&&n.set("imgId",t.id||"")}return r.save({keepFileName:!0,onprogress:e=>{console.log("上传进度",e),a&&a(e)}}).then((e=>(n.set("url",e.url()||""),n.set("fileId",e.id||""),n.save().then((e=>e)))),(function(e){console.error("上传失败",e)}))},k=async e=>{let t=await new u("Book").equalTo("objectId",e).first();const o=s.Object.createWithoutData("Book",e),r=s.File.createWithoutData(t?.attributes?.fileId),n=s.File.createWithoutData(t?.attributes?.imgId);return t?.attributes?.imgId&&n.destroy(),t?.attributes?.fileId&&r.destroy(),o.destroy()},y=(e,t)=>{const o=s.Object.createWithoutData("Book",e);return o.set("marks",t),o.save().then((function(e){return e}),(function(e){console.error("保存失败",e)}))},v=(e,t)=>{const o=s.Object.createWithoutData("Book",e);return o.set("marks",t),o.save().then((function(e){return e}),(function(e){console.error("保存失败",e)}))},g=e=>new u("Book").equalTo("objectId",e).first().then((function(e){return e}),(function(e){console.error("操作失败",e)})),q=Object.freeze(Object.defineProperty({__proto__:null,get:m,getById:g,handleDelete:k,saveMark:y,update:h,updateMark:v,upload:f},Symbol.toStringTag,{value:"Module"})),B=(e=document.body)=>({show({precent:t=0}={}){let o=e.querySelector(".byt-space-loading");if(o){let e=o.querySelector(".percent");e&&(e.innerHTML=`${t}%`)}else{if(o=document.createElement("div"),o.classList.add("byt-space-loading","!h-[100vh]","w-full","absolute","backdrop-blur-sm"),o.appendChild(document.createElement("span")),o.appendChild(document.createElement("span")),o.appendChild(document.createElement("span")),void 0!==t){let e=document.createElement("div");e.classList.add("text-[var(--byt-main-color)]","percent","ml-2"),o.appendChild(e)}e.appendChild(o)}},hide(){e.querySelector(".byt-space-loading")?.remove()}});export{q as b,k as h,B as l,f as u};