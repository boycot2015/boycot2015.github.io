---
// é™æ€å›¾ç‰‡
// Svg ç»„ä»¶
import Svg from "@/components/Svg/Svg.astro";
// æ—¶é—´å¤„ç†
import { fmtTime, getIP, getGreat, getScentence, getWeather } from "@/utils/index";
// è·å–ç”¨æˆ·é…ç½®æ•°æ®
import SITE_CONFIG from "@/config";
const { Avatar, Author, Motto, WebSites, GoogleAds, AsideShow } = SITE_CONFIG;
// è·å–æ–‡ç« æ•°æ®
import { getCategories, getTags, getRecommendArticles, getCountInfo } from "@/utils/getPostInfo";
// è·å–æ•°æ®ç»Ÿè®¡
// åˆ†ç±»åˆ—è¡¨
const categories = getCategories();
// çƒ­é—¨æ ‡ç­¾
const tags = getTags();

// è·å–ç½‘ç«™ç»Ÿè®¡æ•°æ®
const CountInfo = getCountInfo();

// è·å–ç”¨æˆ· IP åœ°å€
const { ip, location, city } = await getIP();
// const { ip, location } = { ip: '127.0.0.1', location: 'åŒ—äº¬' }

// è·å–å¤©æ°”ä¿¡æ¯
const weather = await getWeather(city);

// console.log(city, 'city');

// è·å–å½“å‰æ—¶é—´é—®å€™
const great = getGreat();

const scentence = await getScentence();
// console.log(scentence, 'scentence');
// æœ€æ–°æ–‡ç« 
const recommendArticles = getRecommendArticles();
// Google å¹¿å‘Šç»„ä»¶
import GoogleAd from "@/components/GoogleAd/GoogleAd.astro";
// ä¾§è¾¹æ æ ·å¼
import "./Aside.less";
export const prerender = false
---

<aside class="byt-aside">
	<!-- å¤´åƒå— -->
	{
		AsideShow.WebSitesShow && (
			<section class="byt-aside-item user">
				<img class="byt-aside-avatar" src="/assets/images/lazy-loading.webp" data-byt-lz-src={Avatar} alt={Author} />
				<span class="byt-aside-auther">{Author}</span>
				<p class="byt-aside-motto">{Motto}</p>
				<section class="byt-aside-links">
					{WebSites.map(item => (
						<a class="byt-aside-links-item" href={item.link} title={item.text} target="_blank" rel="noopener nofollow">
							<Svg src={item.icon} />
						</a>
					))}
				</section>
				<section class="byt-aside-info">
					<div class="art-item count">
						<span>{CountInfo.ArticleCount}</span>
						<p>æ–‡ç« æ•°</p>
					</div>
					<div class="cat-item count">
						<span>{CountInfo.CategoryCount}</span>
						<p>åˆ†ç±»æ•°</p>
					</div>
					<div class="tag-item count">
						<span>{CountInfo.TagCount}</span>
						<p>æ ‡ç­¾æ•°</p>
					</div>
				</section>
				<canvas class="byt-aside-canvas" width="888" height="1888" />
			</section>
		)
	}
	<!-- éšæœºå¥å­å— -->
	{
		AsideShow.ScentenceShow && (
			<section class="w-full byt-aside-item !items-start scentence !p-0">
				<div class="header text-center text-xl !tracking-widest leading-[48px] text-[#fff] w-full">
					<img src="/assets/images/lazy-loading.webp" data-byt-lz-src={SITE_CONFIG.imgApi} alt={scentence.from} />
				</div>
				<p class="line-clamp-2 px-2 text-justify">{scentence.hitokoto}</p>
				<div class="footer w-full flex justify-between px-2 pb-2">
					<span></span>
					<div class="right flex items-center gap-1 text-xs">
						<span>ã€{scentence.from}ã€‘{scentence.from_who ? `â€” ${scentence.from_who}` : ''}</span>
					</div>
				</div>
			</section>
		)
	}
	<!-- åšå®¢è·¯ç‰Œå— -->
	{
		AsideShow.BlogsignageShow && SITE_CONFIG.Blogsignage && (
			<section class="w-full byt-aside-item blogsignage !p-0">
				<div class="header flex justify-between text-center text-xl !tracking-widest leading-[48px] text-[#fff] w-full !bg-[var(--byt-main-color)] px-2">
					<div class="left flex items-center gap-1">
						<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"><!-- Icon from Material Design Icons by Pictogrammers - https://github.com/Templarian/MaterialDesign/blob/master/LICENSE --><path fill="currentColor" d="M20 9v6h-8v4.84L4.16 12L12 4.16V9z"/></svg>
						è¥¿
					</div>
					<p class="flex-1">{SITE_CONFIG.Blogsignage}</p>
					<div class="right flex items-center gap-1">
						ä¸œ
						<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"><!-- Icon from Material Design Icons by Pictogrammers - https://github.com/Templarian/MaterialDesign/blob/master/LICENSE --><path fill="currentColor" d="M4 15V9h8V4.16L19.84 12L12 19.84V15z"/></svg>
					</div>
				</div>
				<div class="footer weather w-full flex items-center justify-between px-2 pb-2">
					<span>{weather?.air_quality?.aqi || '-'}&nbsp;{weather?.air_quality?.quality || '-'}</span>
					<span>{weather?.location?.city || '-'}&nbsp;{weather?.weather?.condition || '-'}&nbsp;{weather?.weather?.temp || '25'}â„ƒ {!weather ? SITE_CONFIG.Author: ''}</span>
					<span class="flex items-center gap-1">
						<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"><!-- Icon from Material Symbols by Google - https://github.com/google/material-design-icons/blob/master/LICENSE --><path fill="currentColor" d="M11.5 20q-1.25 0-2.125-.875T8.5 17h2q0 .425.288.713T11.5 18t.713-.288T12.5 17t-.288-.712T11.5 16H2v-2h9.5q1.25 0 2.125.875T14.5 17t-.875 2.125T11.5 20M2 10V8h13.5q.65 0 1.075-.425T17 6.5t-.425-1.075T15.5 5t-1.075.425T14 6.5h-2q0-1.475 1.013-2.488T15.5 3t2.488 1.013T19 6.5t-1.012 2.488T15.5 10zm16.5 8v-2q.65 0 1.075-.425T20 14.5t-.425-1.075T18.5 13H2v-2h16.5q1.475 0 2.488 1.013T22 14.5t-1.012 2.488T18.5 18"/></svg>
						{weather?.weather?.wind_direction || '-'}
					</span>
				</div>
			</section>
		)
	}
	<!-- å…¬å‘Šå— -->
	{
		SITE_CONFIG.Tips && AsideShow.GreatShow && (
			<section class="byt-aside-item tips">
				<p class="flex items-center gap-2">
					<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><!-- Icon from Material Symbols by Google - https://github.com/google/material-design-icons/blob/master/LICENSE --><path fill="currentColor" d="M9 21v-5q-1.55-.125-3.037-.35T3 15l.5-2q2.075.575 4.2.788T12 14q2.15 0 4.275-.213T20.5 13l.5 2q-1.5.425-2.988.65T15 16v5zm3-8q-.85 0-1.425-.575T10 11q0-.825.575-1.412T12 9q.825 0 1.413.588T14 11q0 .85-.587 1.425T12 13m-7.5-3q-.65 0-1.075-.425T3 8.5q0-.625.425-1.062T4.5 7q.625 0 1.063.438T6 8.5q0 .65-.437 1.075T4.5 10m15 0q-.65 0-1.075-.425T18 8.5q0-.625.425-1.062T19.5 7q.625 0 1.063.438T21 8.5q0 .65-.437 1.075T19.5 10M7.25 6.25q-.65 0-1.075-.425T5.75 4.75q0-.625.425-1.062T7.25 3.25q.625 0 1.063.438T8.75 4.75q0 .65-.437 1.075T7.25 6.25m9.5 0q-.65 0-1.075-.425T15.25 4.75q0-.625.425-1.062t1.075-.438q.625 0 1.063.438t.437 1.062q0 .65-.437 1.075t-1.063.425M12 5q-.65 0-1.075-.425T10.5 3.5q0-.625.425-1.062T12 2q.625 0 1.063.438T13.5 3.5q0 .65-.437 1.075T12 5"/></svg>
					æ¬¢è¿æ¥è®¿è€…!
				</p>
				<div class="tips-content">
					<Fragment set:html={SITE_CONFIG.Description} />
				</div>
				<p>å—·å—·ï¼çƒ­çƒˆæ¬¢è¿ğŸ¤ªï¼æ¥è‡ª <span class="!text-[var(--byt-main-color)] text-shadow-lg">{location}</span>çš„é“é“ï¼Œä½ å¥½å‘€ï¼ğŸ˜</p>
				ä»Šå¤©ä½ å–å¥¶èŒ¶äº†å˜›~ğŸº
				<p>ä½ çš„ç½‘ç»œIPä¸ºï¼š<span class="transition-all duration-300 blur hover:!blur-none">{ip}</span></p>
				ğŸ• {great}
			</section>
		)
	}
	<!-- å…¬å‘Šå— -->
	{
		SITE_CONFIG.Tips && !AsideShow.GreatShow && (
			<section class="byt-aside-item tips">
				<span>
					<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
						<path stroke="none" d="M0 0h24v24H0z" fill="none" />
						<path d="M3 9.662c2 2.338 2 4.338 0 6.338c3 .5 4.5 1 5 4c2 -3 6 -4 9 0c0 -3 1 -4 4 -4.004q -3 -2.995 0 -5.996c-3 0 -5 -2 -5 -5c-2 4 -5 3 -7.5 -1c-.5 3 -2.5 5 -5.5 5.662" />
					</svg>
					å…¬å‘Š
				</span>
				<div class="tips-content">
					<Fragment set:html={SITE_CONFIG.Tips} />
				</div>
				<div class="bg"><img style="width: 100%;" src="/assets/images/notice.avif" alt=""></div>
			</section>
		)
	}


	<!-- åˆ†ç±»å— -->
	{
		AsideShow.CategoriesShow && (
			<section class="byt-aside-item cat">
				<h3 class="flex items-center gap-2">
					<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"><!-- Icon from Tabler Icons by PaweÅ‚ Kuna - https://github.com/tabler/tabler-icons/blob/master/LICENSE --><path fill="none" stroke="#888888" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4h6v6H4zm10 0h6v6h-6zM4 14h6v6H4zm10 3a3 3 0 1 0 6 0a3 3 0 1 0-6 0"/></svg>
					åˆ†ç±»
				</h3>
				<div class="byt-aside-cat">
					{categories
						.sort((a: any, b: any) => b.count - a.count)
						.map(i => (
							<a href={`/categories/${i.title}`}>
								<span>{i.title}</span>
								<i>{i.count}</i>
							</a>
						))}
				</div>
			</section>
		)
	}
	<section class="sticky-aside">

		<!-- æ ‡ç­¾å— -->
		{
			AsideShow.TagsShow && (
				<section class="byt-aside-item tags">
					<h3 class="flex items-center gap-2">
						<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"><!-- Icon from Material Symbols by Google - https://github.com/google/material-design-icons/blob/master/LICENSE --><path fill="#888888" d="M4 22V8q0-.825.588-1.412T6 6h8q.825 0 1.413.588T16 8v14l-6-3zm14-4V4H7V2h11q.825 0 1.413.588T20 4v14z"/></svg>
						çƒ­é—¨æ ‡ç­¾
					</h3>
					<div class="byt-aside-tags">
						{tags.map(i => (
							<a href={`/tag/${i[0]}`}>
								<span>{i[0]}</span>
								<em>{i[1]}</em>
							</a>
						))}
					</div>
				</section>
			)
		}
		<!-- æœ€æ–°æ–‡ç« å— -->
		{
			recommendArticles.length && AsideShow.recommendArticleShow && (
				<section class="byt-aside-item articles">
					<h3 class="flex items-center gap-2">
						<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 14 14"><!-- Icon from Streamline by Streamline - https://creativecommons.org/licenses/by/4.0/ --><g fill="none" stroke="#888888" stroke-linecap="round" stroke-linejoin="round"><path d="M1.5 2.5a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h11a1 1 0 0 0 1-1v-9a1 1 0 0 0-1-1h-2m-7-2v4m7-4v4m-7-2h5"/><path d="M7 7.5c1-2 3-1 3 .5c0 2-3 3-3 3s-3-1-3-3c0-1.5 2-2.5 3-.5Z"/></g></svg>
						æ¨èæ–‡ç« 
					</h3>
					<div class="byt-aside-articles">
						{recommendArticles.map((i, idx) => (
							<a href={`/article/${i.id}`}>
								<span>
									{idx < 3 ? <i>{idx + 1}</i> : <em>{idx + 1}.</em>}
									<cite class="byt-ellipsis">{i.title}</cite>
								</span>
								<time>{fmtTime(i.date, "YYYY-MM-DD A")}</time>
							</a>
						))}
					</div>
				</section>
			)
		}

		<!-- è°·æ­Œå¹¿å‘Šå— -->
		{
			GoogleAds.ad_Client && GoogleAds.asideAD_Slot && (
				<section class="byt-aside-item ad">
					<h3>å¹¿è€Œå‘Šä¹‹</h3>
					<GoogleAd className="byt-aside-ad" slotID={GoogleAds.asideAD_Slot} />
				</section>
			)
		}
		<slot />
	</section>
</aside>
